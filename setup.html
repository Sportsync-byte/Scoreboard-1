<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indoor Cricket - Game Setup</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 1rem;
        }
        .card-header {
            background: #007bff;
            color: white;
            border-radius: 10px 10px 0 0 !important;
        }
        .player-list {
            max-height: 200px;
            overflow-y: auto;
        }
        .player-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            border-bottom: 1px solid #dee2e6;
        }
        .player-item:last-child {
            border-bottom: none;
        }
        .remove-player {
            color: #dc3545;
            cursor: pointer;
        }
        .format-info {
            background-color: #e9ecef;
            padding: 1rem;
            border-radius: 5px;
            margin-top: 0.5rem;
            font-size: 0.9rem;
        }
        .server-status {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9rem;
            z-index: 1000;
        }
        .server-status.connected {
            background-color: #28a745;
            color: white;
        }
        .server-status.disconnected {
            background-color: #dc3545;
            color: white;
        }
        .preconfigured-game {
            cursor: pointer;
            padding: 1rem;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
        }
        .preconfigured-game:hover {
            background-color: #e9ecef;
            border-color: #007bff;
        }
        .preconfigured-game.selected {
            background-color: #e3f2fd;
            border-color: #007bff;
        }
        .search-box {
            margin-bottom: 1rem;
        }
        .quick-fill {
            margin-bottom: 1rem;
            padding: 0.5rem;
            background-color: #e3f2fd;
            border-radius: 5px;
        }
                .resume-game {
            background-color: #fdf9e3;
            padding: 1rem;
            border-radius: 5px;
            margin-bottom: 1rem;
            display: none;
        }
        .resume-game.show {
            display: block;
        }
        .loading-spinner {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
        }
        .loading-spinner.show {
            display: block;
        }
    </style>
</head>
<body class="bg-light">
    <!-- Server Status Indicator -->
    <div id="serverStatus" class="server-status disconnected">
        ðŸ”´ Offline Mode
    </div>

    <!-- Loading Spinner -->
    <div id="loadingSpinner" class="loading-spinner">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <!-- Resume Game Section -->
                <div id="resumeGame" class="resume-game">
                    <h5>Resume Previous Game</h5>
                    <p>There is a saved game available. Would you like to resume?</p>
                    <div class="d-flex gap-2">
                        <button class="btn btn-primary" onclick="resumeGame()">Resume Game</button>
                        <button class="btn btn-secondary" onclick="hideResumeGame()">Start New Game</button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h4 class="mb-0">Game Setup</h4>
                    </div>
                    <div class="card-body">
                        <form id="setupForm">
                            <!-- Game Type Selection -->
                            <div class="mb-4">
                                <h5>Game Type</h5>
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="radio" name="gameType" 
                                           id="customGame" value="custom" checked>
                                    <label class="form-check-label" for="customGame">
                                        Custom Game
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="gameType" 
                                           id="preconfiguredGame" value="preconfigured">
                                    <label class="form-check-label" for="preconfiguredGame">
                                        Preconfigured Game
                                    </label>
                                </div>
                            </div>

                            <!-- Preconfigured Games Section -->
                            <div id="preconfiguredGames" style="display: none;">
                                <div class="search-box">
                                    <input type="text" class="form-control" id="gameSearch" 
                                           placeholder="Search games...">
                                </div>
                                <div id="preconfiguredGamesList">
                                    <!-- Games will be loaded here -->
                                </div>
                            </div>
                                                        <!-- Custom Game Setup -->
                            <div id="customGameSetup">
                                <!-- Quick Fill Section -->
                                <div class="quick-fill">
                                    <h6>Quick Fill Options</h6>
                                    <div class="d-flex gap-2">
                                        <button type="button" class="btn btn-secondary btn-sm" 
                                                onclick="quickFillLastMatch()">Last Match</button>
                                        <button type="button" class="btn btn-secondary btn-sm" 
                                                onclick="showSavedTeams()">Saved Teams</button>
                                    </div>
                                </div>

                                <!-- Game Format -->
                                <div class="mb-4">
                                    <h5>Game Format</h5>
                                    <div class="mb-3">
                                        <label>Select Format:</label>
                                        <select id="gameFormat" class="form-select" required 
                                                onchange="updateFormatInfo()">
                                            <option value="8aside">8-a-side</option>
                                            <option value="6aside">6-a-side</option>
                                        </select>
                                    </div>
                                    <div id="formatInfo" class="format-info">
                                        <strong>8-a-side Format:</strong><br>
                                        - 16 overs per innings<br>
                                        - 4 overs per partnership<br>
                                        - 2 overs per bowler
                                    </div>
                                </div>

                                <!-- Team Information -->
                                <div class="mb-4">
                                    <h5>Team Information</h5>
                                    <div class="mb-3">
                                        <label>Batting Team Name:</label>
                                        <input type="text" id="battingTeam" class="form-control" 
                                               required list="savedTeamsList">
                                    </div>
                                    <div class="mb-3">
                                        <label>Fielding Team Name:</label>
                                        <input type="text" id="fieldingTeam" class="form-control" 
                                               required list="savedTeamsList">
                                    </div>
                                </div>

                                <!-- Game Settings -->
                                <div class="mb-4">
                                    <h5>Game Settings</h5>
                                    <div class="mb-3">
                                        <label>Match Duration (minutes):</label>
                                        <input type="number" id="matchDuration" class="form-control" 
                                               value="40" required min="1">
                                    </div>
                                </div>
                                                                <!-- Batting Team Players -->
                                <div class="mb-4">
                                    <h5>Batting Team Players</h5>
                                    <div class="input-group mb-2">
                                        <input type="text" id="newBatsman" class="form-control" 
                                               placeholder="Enter batsman name" list="playerNamesList">
                                        <button type="button" class="btn btn-primary" onclick="addBatsman()">Add</button>
                                    </div>
                                    <div id="batsmenList" class="player-list"></div>
                                </div>

                                <!-- Fielding Team Players -->
                                <div class="mb-4">
                                    <h5>Fielding Team Players</h5>
                                    <div class="input-group mb-2">
                                        <input type="text" id="newBowler" class="form-control" 
                                               placeholder="Enter bowler name" list="playerNamesList">
                                        <button type="button" class="btn btn-primary" onclick="addBowler()">Add</button>
                                    </div>
                                    <div id="bowlersList" class="player-list"></div>
                                </div>
                            </div>

                            <button type="submit" class="btn btn-success w-100">Start Match</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Datalists for autocomplete -->
    <datalist id="savedTeamsList">
        <!-- Will be populated with saved team names -->
    </datalist>
    <datalist id="playerNamesList">
        <!-- Will be populated with saved player names -->
    </datalist>

    <!-- Modal for Saved Teams -->
    <div class="modal fade" id="savedTeamsModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Saved Teams</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="savedTeamsList">
                        <!-- Will be populated with saved teams -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Confirmation -->
    <div class="modal fade" id="confirmationModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Confirmation</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p id="confirmationMessage"></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="confirmationAction">Confirm</button>
                </div>
            </div>
        </div>
    </div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global variables
        let batsmen = [];
        let bowlers = [];
        let savedTeams = JSON.parse(localStorage.getItem('savedTeams')) || {};
        let serverConnected = false;
        let selectedPreconfiguredGame = null;

        // Server connection check and status update
        async function checkServerConnection() {
            try {
                const response = await fetch('YOUR_SERVER_URL/ping', {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });
                serverConnected = response.ok;
                updateServerStatus();
            } catch (error) {
                serverConnected = false;
                updateServerStatus();
            }
        }

        function updateServerStatus() {
            const statusElement = document.getElementById('serverStatus');
            if (serverConnected) {
                statusElement.className = 'server-status connected';
                statusElement.innerHTML = 'ðŸŸ¢ Server Connected';
            } else {
                statusElement.className = 'server-status disconnected';
                statusElement.innerHTML = 'ðŸ”´ Offline Mode';
            }
        }

        // Check for saved game on load
        function checkSavedGame() {
            const savedGame = localStorage.getItem('indoorCricketGame');
            if (savedGame) {
                document.getElementById('resumeGame').classList.add('show');
            }
        }

        function resumeGame() {
            window.location.href = 'umpire.html';
        }

        function hideResumeGame() {
            document.getElementById('resumeGame').classList.remove('show');
        }

        // Game type selection handler
        document.querySelectorAll('input[name="gameType"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const preconfiguredSection = document.getElementById('preconfiguredGames');
                const customSection = document.getElementById('customGameSetup');
                
                if (this.value === 'preconfigured') {
                    preconfiguredSection.style.display = 'block';
                    customSection.style.display = 'none';
                    loadPreconfiguredGames();
                } else {
                    preconfiguredSection.style.display = 'none';
                    customSection.style.display = 'block';
                }
            });
        });

        // Format information update
        function updateFormatInfo() {
            const format = document.getElementById('gameFormat').value;
            const infoDiv = document.getElementById('formatInfo');
            
            if (format === '6aside') {
                infoDiv.innerHTML = `
                    <strong>6-a-side Format:</strong><br>
                    - 12 overs per innings<br>
                    - 3 overs per partnership<br>
                    - 2 overs per bowler
                `;
            } else {
                infoDiv.innerHTML = `
                    <strong>8-a-side Format:</strong><br>
                    - 16 overs per innings<br>
                    - 4 overs per partnership<br>
                    - 2 overs per bowler
                `;
            }
            validatePlayerCounts();
        }
                // Player management functions
        function addBatsman() {
            const input = document.getElementById('newBatsman');
            const name = input.value.trim();
            const format = document.getElementById('gameFormat').value;
            const maxPlayers = format === '6aside' ? 6 : 8;

            if (batsmen.length >= maxPlayers) {
                showAlert(`Maximum ${maxPlayers} players allowed for ${format} format`);
                return;
            }

            if (name) {
                if (batsmen.some(b => b.name.toLowerCase() === name.toLowerCase())) {
                    showAlert('Player already added to batting team');
                    return;
                }

                batsmen.push({
                    id: Date.now(),
                    name: name,
                    score: 0,
                    balls: 0,
                    fours: 0,
                    sixes: 0,
                    partnerships: []
                });
                updateBatsmenList();
                input.value = '';
                saveToLocalStorage();
            }
        }

        function addBowler() {
            const input = document.getElementById('newBowler');
            const name = input.value.trim();
            const format = document.getElementById('gameFormat').value;
            const maxPlayers = format === '6aside' ? 6 : 8;

            if (bowlers.length >= maxPlayers) {
                showAlert(`Maximum ${maxPlayers} players allowed for ${format} format`);
                return;
            }

            if (name) {
                if (bowlers.some(b => b.name.toLowerCase() === name.toLowerCase())) {
                    showAlert('Player already added to fielding team');
                    return;
                }

                bowlers.push({
                    id: Date.now(),
                    name: name,
                    overs: 0,
                    wickets: 0,
                    runs: 0,
                    maidens: 0
                });
                updateBowlersList();
                input.value = '';
                saveToLocalStorage();
            }
        }

        function removeBatsman(id) {
            showConfirmation(
                'Remove player?',
                'Are you sure you want to remove this player?',
                () => {
                    batsmen = batsmen.filter(b => b.id !== id);
                    updateBatsmenList();
                    saveToLocalStorage();
                }
            );
        }

        function removeBowler(id) {
            showConfirmation(
                'Remove player?',
                'Are you sure you want to remove this player?',
                () => {
                    bowlers = bowlers.filter(b => b.id !== id);
                    updateBowlersList();
                    saveToLocalStorage();
                }
            );
        }

        function updateBatsmenList() {
            const list = document.getElementById('batsmenList');
            const format = document.getElementById('gameFormat').value;
            const maxPlayers = format === '6aside' ? 6 : 8;
            
            list.innerHTML = batsmen.map(batsman => `
                <div class="player-item">
                    <span>${batsman.name}</span>
                    <span class="remove-player" onclick="removeBatsman(${batsman.id})">Ã—</span>
                </div>
            `).join('') + `
                <div class="text-muted mt-2">
                    ${batsmen.length}/${maxPlayers} players added
                </div>
            `;
        }

        function updateBowlersList() {
            const list = document.getElementById('bowlersList');
            const format = document.getElementById('gameFormat').value;
            const maxPlayers = format === '6aside' ? 6 : 8;
            
            list.innerHTML = bowlers.map(bowler => `
                <div class="player-item">
                    <span>${bowler.name}</span>
                    <span class="remove-player" onclick="removeBowler(${bowler.id})">Ã—</span>
                </div>
            `).join('') + `
                <div class="text-muted mt-2">
                    ${bowlers.length}/${maxPlayers} players added
                </div>
            `;
        }
                // Preconfigured games handling
        async function loadPreconfiguredGames() {
            const gamesList = document.getElementById('preconfiguredGamesList');
            showLoading();

            try {
                if (serverConnected) {
                    // Fetch from server
                    const response = await fetch('YOUR_SERVER_URL/games');
                    const games = await response.json();
                    localStorage.setItem('preconfiguredGames', JSON.stringify(games));
                    displayPreconfiguredGames(games);
                } else {
                    // Load from local storage
                    const games = JSON.parse(localStorage.getItem('preconfiguredGames')) || [];
                    displayPreconfiguredGames(games);
                }
            } catch (error) {
                showAlert('Error loading games. Please try again.');
                console.error('Error:', error);
            } finally {
                hideLoading();
            }
        }

        function displayPreconfiguredGames(games) {
            const gamesList = document.getElementById('preconfiguredGamesList');
            if (games.length === 0) {
                gamesList.innerHTML = '<p class="text-muted">No games available</p>';
                return;
            }

            gamesList.innerHTML = games.map(game => `
                <div class="preconfigured-game" onclick="selectPreconfiguredGame(${game.id})">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="mb-0">${game.homeTeam} vs ${game.awayTeam}</h6>
                            <small class="text-muted">${new Date(game.date).toLocaleDateString()}</small>
                            <div class="small text-muted">${game.venue}</div>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="preconfiguredGame" 
                                   id="game${game.id}" value="${game.id}">
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function selectPreconfiguredGame(gameId) {
            const games = JSON.parse(localStorage.getItem('preconfiguredGames')) || [];
            const game = games.find(g => g.id === gameId);
            if (!game) return;

            selectedPreconfiguredGame = game;
            document.querySelectorAll('.preconfigured-game').forEach(div => {
                div.classList.remove('selected');
            });
            document.querySelector(`#game${gameId}`).closest('.preconfigured-game').classList.add('selected');
        }

        // Quick fill and saved teams handling
        function quickFillLastMatch() {
            const lastMatch = JSON.parse(localStorage.getItem('lastMatch'));
            if (!lastMatch) {
                showAlert('No previous match data available');
                return;
            }

            showConfirmation(
                'Load Last Match',
                'This will replace current setup with last match data. Continue?',
                () => {
                    document.getElementById('battingTeam').value = lastMatch.battingTeam;
                    document.getElementById('fieldingTeam').value = lastMatch.fieldingTeam;
                    document.getElementById('gameFormat').value = lastMatch.format;
                    batsmen = [...lastMatch.batsmen];
                    bowlers = [...lastMatch.bowlers];
                    updateBatsmenList();
                    updateBowlersList();
                    updateFormatInfo();
                }
            );
        }
               function showSavedTeams() {
            const modal = new bootstrap.Modal(document.getElementById('savedTeamsModal'));
            const teamsList = document.getElementById('savedTeamsList');
            
            teamsList.innerHTML = Object.entries(savedTeams)
                .sort((a, b) => new Date(b[1].lastUsed) - new Date(a[1].lastUsed))
                .map(([teamName, team]) => `
                    <div class="saved-team-item p-2 border-bottom">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-0">${teamName}</h6>
                                <small class="text-muted">Last used: ${new Date(team.lastUsed).toLocaleDateString()}</small>
                            </div>
                            <div class="btn-group">
                                <button class="btn btn-sm btn-primary" 
                                        onclick="loadSavedTeam('${teamName}', 'batting')">
                                    Load as Batting
                                </button>
                                <button class="btn btn-sm btn-secondary" 
                                        onclick="loadSavedTeam('${teamName}', 'fielding')">
                                    Load as Fielding
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            
            modal.show();
        }

        function loadSavedTeam(teamName, type) {
            const team = savedTeams[teamName];
            if (!team) return;

            if (type === 'batting') {
                document.getElementById('battingTeam').value = teamName;
                batsmen = team.players.map(name => ({
                    id: Date.now() + Math.random(),
                    name: name,
                    score: 0,
                    balls: 0,
                    fours: 0,
                    sixes: 0,
                    partnerships: []
                }));
                updateBatsmenList();
            } else {
                document.getElementById('fieldingTeam').value = teamName;
                bowlers = team.players.map(name => ({
                    id: Date.now() + Math.random(),
                    name: name,
                    overs: 0,
                    wickets: 0,
                    runs: 0,
                    maidens: 0
                }));
                updateBowlersList();
            }

            bootstrap.Modal.getInstance(document.getElementById('savedTeamsModal')).hide();
        }

        // Validation and form submission
        function validatePlayerCounts() {
            const format = document.getElementById('gameFormat').value;
            const maxPlayers = format === '6aside' ? 6 : 8;
            
            while (batsmen.length > maxPlayers) {
                batsmen.pop();
            }
            while (bowlers.length > maxPlayers) {
                bowlers.pop();
            }
            
            updateBatsmenList();
            updateBowlersList();
        }

        function validateForm() {
            const format = document.getElementById('gameFormat').value;
            const maxPlayers = format === '6aside' ? 6 : 8;

            if (batsmen.length !== maxPlayers) {
                showAlert(`Exactly ${maxPlayers} batsmen required for ${format} format`);
                return false;
            }

            if (bowlers.length !== maxPlayers) {
                showAlert(`Exactly ${maxPlayers} bowlers required for ${format} format`);
                return false;
            }

            return true;
        }
                // Form submission and game initialization
        document.getElementById('setupForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!validateForm()) return;

            const gameType = document.querySelector('input[name="gameType"]:checked').value;
            let gameState;

            if (gameType === 'preconfigured' && selectedPreconfiguredGame) {
                gameState = initializePreconfiguredGame();
            } else {
                gameState = initializeCustomGame();
            }

            try {
                showLoading();
                
                // Save game state
                localStorage.setItem('indoorCricketGame', JSON.stringify(gameState));
                
                // Save as last match
                localStorage.setItem('lastMatch', JSON.stringify({
                    battingTeam: gameState.battingTeam,
                    fieldingTeam: gameState.fieldingTeam,
                    format: gameState.format,
                    batsmen: batsmen,
                    bowlers: bowlers,
                    date: new Date().toISOString()
                }));

                // Save team details
                saveTeamDetails(gameState.battingTeam, batsmen);
                saveTeamDetails(gameState.fieldingTeam, bowlers);

                // Open scoreboard in new window
                window.open('scoreboard.html', 'scoreboardWindow', 'width=1920,height=1080');
                
                // Redirect to umpire interface
                window.location.href = 'umpire.html';
            } catch (error) {
                console.error('Error starting game:', error);
                showAlert('Error starting game. Please try again.');
                hideLoading();
            }
        });

        function initializeCustomGame() {
            const format = document.getElementById('gameFormat').value;
            return {
                format: format,
                battingTeam: document.getElementById('battingTeam').value,
                fieldingTeam: document.getElementById('fieldingTeam').value,
                matchDuration: parseInt(document.getElementById('matchDuration').value),
                totalOvers: format === '6aside' ? 12 : 16,
                partnershipOvers: format === '6aside' ? 3 : 4,
                currentScore: 0,
                wickets: 0,
                currentOver: 0,
                currentPartnership: 0,
                totalPartnerships: format === '6aside' ? 3 : 4,
                batsmen: batsmen,
                bowlers: bowlers,
                currentBatsmen: {
                    striker: null,
                    nonStriker: null
                },
                currentBowler: null,
                ballHistory: [],
                partnerships: [],
                extras: {
                    wides: 0,
                    noBalls: 0,
                    legsideWides: 0
                },
                timer: {
                    isRunning: false,
                    elapsed: 0,
                    startTime: 0
                },
                matchStatus: 'active',
                matchId: Date.now(),
                isSecondInnings: false,
                firstInnings: {
                    score: 0,
                    partnerships: []
                }
            };
        }
               function initializePreconfiguredGame() {
            const gameState = initializeCustomGame();
            Object.assign(gameState, {
                venue: selectedPreconfiguredGame.venue,
                competition: selectedPreconfiguredGame.competition,
                date: selectedPreconfiguredGame.date,
                preconfiguredGameId: selectedPreconfiguredGame.id
            });
            return gameState;
        }

        function saveTeamDetails(teamName, players) {
            if (!teamName) return;
            
            savedTeams[teamName] = {
                players: players.map(p => p.name),
                lastUsed: new Date().toISOString()
            };
            localStorage.setItem('savedTeams', JSON.stringify(savedTeams));
            updateTeamAutocomplete();
        }

        // Utility functions
        function showLoading() {
            document.getElementById('loadingSpinner').classList.add('show');
        }

        function hideLoading() {
            document.getElementById('loadingSpinner').classList.remove('show');
        }

        function showAlert(message) {
            // You can replace this with a custom alert UI
            alert(message);
        }

        function showConfirmation(title, message, onConfirm) {
            const modal = document.getElementById('confirmationModal');
            const modalInstance = new bootstrap.Modal(modal);
            
            modal.querySelector('.modal-title').textContent = title;
            modal.querySelector('#confirmationMessage').textContent = message;
            
            const confirmButton = modal.querySelector('#confirmationAction');
            confirmButton.onclick = () => {
                onConfirm();
                modalInstance.hide();
            };
            
            modalInstance.show();
        }

        function saveToLocalStorage() {
            const setupData = {
                batsmen,
                bowlers,
                format: document.getElementById('gameFormat').value,
                battingTeam: document.getElementById('battingTeam').value,
                fieldingTeam: document.getElementById('fieldingTeam').value,
                matchDuration: document.getElementById('matchDuration').value
            };
            localStorage.setItem('setupInProgress', JSON.stringify(setupData));
        }

        function loadFromLocalStorage() {
            const setupData = JSON.parse(localStorage.getItem('setupInProgress'));
            if (setupData) {
                document.getElementById('gameFormat').value = setupData.format;
                document.getElementById('battingTeam').value = setupData.battingTeam;
                document.getElementById('fieldingTeam').value = setupData.fieldingTeam;
                document.getElementById('matchDuration').value = setupData.matchDuration;
                batsmen = setupData.batsmen || [];
                bowlers = setupData.bowlers || [];
                updateBatsmenList();
                updateBowlersList();
                updateFormatInfo();
            }
        }

        // Search functionality for preconfigured games
        document.getElementById('gameSearch').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const games = JSON.parse(localStorage.getItem('preconfiguredGames')) || [];
            const filteredGames = games.filter(game => 
                game.homeTeam.toLowerCase().includes(searchTerm) ||
                game.awayTeam.toLowerCase().includes(searchTerm) ||
                game.venue.toLowerCase().includes(searchTerm)
            );
            displayPreconfiguredGames(filteredGames);
        });

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            checkServerConnection();
            checkSavedGame();
            loadFromLocalStorage();
            updateTeamAutocomplete();
            
            // Set up autosave
            ['gameFormat', 'battingTeam', 'fieldingTeam', 'matchDuration'].forEach(id => {
                document.getElementById(id).addEventListener('change', saveToLocalStorage);
            });
        });

        function updateTeamAutocomplete() {
            const datalist = document.getElementById('savedTeamsList');
            datalist.innerHTML = Object.keys(savedTeams).map(team => 
                `<option value="${team}">`
            ).join('');
        }
    </script>
</body>
</html> 
