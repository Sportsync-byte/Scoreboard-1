    <script>
        let currentInningsData = {
            totalScore: 0,
            wickets: 0,
            overs: 0,
            balls: 0,
            batsman1Score: 0,
            batsman1Balls: 0,
            batsman2Score: 0,
            batsman2Balls: 0,
            currentBowler: '',
            onStrike: 'batsman1',
            partnershipOvers: 0,
            partnershipNumber: 1
        };

        function startMatch() {
            localStorage.setItem("matchFormat", document.getElementById("matchFormat").value);
            localStorage.setItem("teamA", document.getElementById("teamAInput").value);
            localStorage.setItem("teamB", document.getElementById("teamBInput").value);
            localStorage.setItem("battingFirst", document.getElementById("battingFirst").value);
            localStorage.setItem("inningsTimer", document.getElementById("inningsTimer").value);
            
            localStorage.setItem("matchData", JSON.stringify(currentInningsData));
            
            window.open('scoreboard.html', 'LiveScoreboard', 
                'width=1200,height=800,menubar=no,toolbar=no,location=no,status=no');
            
            document.getElementById("preGameSetup").style.display = "none";
            document.getElementById("batsmanBowlerSetup").style.display = "block";
        }
        
        function confirmBatsmenBowler() {
            localStorage.setItem("batsman1", document.getElementById("batsman1Input").value);
            localStorage.setItem("batsman2", document.getElementById("batsman2Input").value);
            localStorage.setItem("bowler", document.getElementById("bowlerInput").value);
            currentInningsData.currentBowler = document.getElementById("bowlerInput").value;
            
            document.getElementById("batsmanBowlerSetup").style.display = "none";
            document.getElementById("scoringControls").style.display = "block";
            updateDisplay();
        }
        
        function addRun(runs) {
            currentInningsData.totalScore += runs;
            if (currentInningsData.onStrike === 'batsman1') {
                currentInningsData.batsman1Score += runs;
                currentInningsData.batsman1Balls++;
                if (runs % 2 === 1) currentInningsData.onStrike = 'batsman2';
            } else {
                currentInningsData.batsman2Score += runs;
                currentInningsData.batsman2Balls++;
                if (runs % 2 === 1) currentInningsData.onStrike = 'batsman1';
            }
            
            currentInningsData.balls++;
            currentInningsData.partnershipOvers = currentInningsData.overs + (currentInningsData.balls / 6);

            if (currentInningsData.partnershipOvers >= 4) {
                promptNewBatsmen();
                currentInningsData.partnershipOvers = 0;
                currentInningsData.partnershipNumber++;
            }

            if (currentInningsData.balls === 6) {
                promptNewBowler();
                currentInningsData.overs++;
                currentInningsData.balls = 0;
                currentInningsData.onStrike = (currentInningsData.onStrike === 'batsman1') ? 'batsman2' : 'batsman1';
            }
            
            updateStorage();
            updateDisplay();
        }

        function promptNewBowler() {
            let newBowler = prompt("Enter new bowler's name:");
            if (newBowler) {
                currentInningsData.currentBowler = newBowler;
                localStorage.setItem("bowler", newBowler);
            }
        }

        function promptNewBatsmen() {
            let batsman1 = prompt("Enter new Batsman 1:");
            let batsman2 = prompt("Enter new Batsman 2:");
            if (batsman1 && batsman2) {
                localStorage.setItem("batsman1", batsman1);
                localStorage.setItem("batsman2", batsman2);
                currentInningsData.batsman1Score = 0;
                currentInningsData.batsman1Balls = 0;
                currentInningsData.batsman2Score = 0;
                currentInningsData.batsman2Balls = 0;
                currentInningsData.onStrike = 'batsman1';
            }
        }

        function wicket() {
            currentInningsData.wickets++;
            currentInningsData.totalScore -= 5;
            updateStorage();
            updateDisplay();
        }

        function addExtra(type) {
            switch(type) {
                case 'wide':
                case 'noBall':
                    currentInningsData.totalScore += 1;
                    break;
                case 'bye':
                case 'legBye':
                    // Handle these cases if needed
                    break;
            }
            updateStorage();
            updateDisplay();
        }

        function endOver() {
            promptNewBowler();
            currentInningsData.overs++;
            currentInningsData.balls = 0;
            currentInningsData.onStrike = (currentInningsData.onStrike === 'batsman1') ? 'batsman2' : 'batsman1';
            updateStorage();
            updateDisplay();
        }

        function changeBowler() {
            promptNewBowler();
        }

        function updateStorage() {
            localStorage.setItem("matchData", JSON.stringify(currentInningsData));
            window.dispatchEvent(new Event('storage'));
        }

        function updateDisplay() {
            document.getElementById("currentScoreDisplay").textContent = 
                `${currentInningsData.totalScore}/${currentInningsData.wickets}`;
            document.getElementById("oversDisplay").textContent = 
                `${currentInningsData.overs}.${currentInningsData.balls}`;
            
            document.getElementById("batsman1Details").textContent = 
                `${localStorage.getItem("batsman1")}: ${currentInningsData.batsman1Score} (${currentInningsData.batsman1Balls})` +
                (currentInningsData.onStrike === 'batsman1' ? ' *' : '') +
                ` | Partnership ${currentInningsData.partnershipNumber}`;
            
            document.getElementById("batsman2Details").textContent = 
                `${localStorage.getItem("batsman2")}: ${currentInningsData.batsman2Score} (${currentInningsData.batsman2Balls})` +
                (currentInningsData.onStrike === 'batsman2' ? ' *' : '');
        }

        document.addEventListener('DOMContentLoaded', function() {
            const savedMatchData = localStorage.getItem("matchData");
            if (savedMatchData) {
                currentInningsData = JSON.parse(savedMatchData);
                updateDisplay();
            }
        });
    </script>
</body>
</html>
