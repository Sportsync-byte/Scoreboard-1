<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indoor Cricket Umpire's Interface</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 1rem;
        }
        .card-header {
            background: #007bff;
            color: white;
            border-radius: 10px 10px 0 0 !important;
        }
        .preview-scoreboard {
            background: #1a1a1a;
            color: white;
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1rem;
        }
        .timer {
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            margin: 1rem 0;
        }
        .btn-group {
            gap: 0.5rem;
        }
        .btn {
            border-radius: 5px;
            padding: 0.5rem 1rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        .btn-outline-primary {
            color: #007bff;
            border-color: #007bff;
        }
        .btn-outline-primary:hover {
            background-color: #007bff;
            color: white;
        }
        .btn-outline-danger {
            color: #dc3545;
            border-color: #dc3545;
        }
        .btn-outline-danger:hover {
            background-color: #dc3545;
            color: white;
        }
        .btn-outline-secondary {
            color: #6c757d;
            border-color: #6c757d;
        }
        .btn-outline-secondary:hover {
            background-color: #6c757d;
            color: white;
        }
        .btn-outline-success {
            color: #28a745;
            border-color: #28a745;
        }
        .btn-outline-success:hover {
            background-color: #28a745;
            color: white;
        }
        .btn-outline-info {
            color: #17a2b8;
            border-color: #17a2b8;
        }
        .btn-outline-info:hover {
            background-color: #17a2b8;
            color: white;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }
        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 20px;
            border-radius: 10px;
            width: 80%;
            max-width: 500px;
        }
        .custom-runs-input {
            width: 100px;
            margin: 0 0.5rem;
        }
        .warning-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #dc3545;
            color: white;
            padding: 1rem;
            border-radius: 10px;
            z-index: 1000;
            text-align: center;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.05); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }
        .player-select-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }
        .player-select-content {
            background-color: white;
            margin: 15% auto;
            padding: 20px;
            border-radius: 10px;
            width: 80%;
            max-width: 400px;
        }
        .player-list {
            max-height: 300px;
            overflow-y: auto;
            margin: 1rem 0;
        }
        .player-item {
            padding: 0.5rem;
            border-bottom: 1px solid #dee2e6;
            cursor: pointer;
        }
        .player-item:hover {
            background-color: #f8f9fa;
        }
        .player-item.selected {
            background-color: #e3f2fd;
        }
    </style>
</head>
<body class="bg-light">
    <div class="container-fluid">
        <div class="row">
            <!-- Preview Scoreboard -->
            <div class="col-12 preview-scoreboard">
                <div class="row">
                    <div class="col-md-4 text-center">
                        <h3 id="previewBattingTeam">Team A</h3>
                    </div>
                    <div class="col-md-4 text-center">
                        <h3 id="previewScore">0/0</h3>
                        <div id="previewOvers">0.0/16.0</div>
                    </div>
                    <div class="col-md-4 text-center">
                        <h3 id="previewFieldingTeam">Team B</h3>
                    </div>
                </div>
            </div>

            <!-- Timer -->
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h4 class="mb-0">Match Timer</h4>
                    </div>
                    <div class="card-body">
                        <div class="timer" id="matchTimer">00:00</div>
                        <div class="text-center">
                            <button class="btn btn-success" onclick="startTimer()">Start</button>
                            <button class="btn btn-danger" onclick="stopTimer()">Stop</button>
                            <button class="btn btn-secondary" onclick="resetTimer()">Reset</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Current Batsmen and Scoring -->
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h4 class="mb-0">Current Players & Scoring</h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <!-- Current Batsmen -->
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label>Striker:</label>
                                    <div class="d-flex align-items-center">
                                        <span id="strikerName">Select Striker</span>
                                        <button class="btn btn-sm btn-outline-primary ms-2" onclick="showPlayerSelect('striker')">Change</button>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label>Non-Striker:</label>
                                    <div class="d-flex align-items-center">
                                        <span id="nonStrikerName">Select Non-Striker</span>
                                        <button class="btn btn-sm btn-outline-primary ms-2" onclick="showPlayerSelect('nonStriker')">Change</button>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label>Current Bowler:</label>
                                    <div class="d-flex align-items-center">
                                        <span id="currentBowlerName">Select Bowler</span>
                                        <button class="btn btn-sm btn-outline-primary ms-2" onclick="showPlayerSelect('bowler')">Change</button>
                                    </div>
                                </div>
                                <button class="btn btn-outline-info w-100" onclick="changeStrike()">Change Strike</button>
                            </div>

                            <!-- Scoring Buttons -->
                            <div class="col-md-8">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="btn-group w-100 mb-2">
                                            <button class="btn btn-outline-primary" onclick="handleBall(0)">0</button>
                                            <button class="btn btn-outline-primary" onclick="handleBall(1)">1</button>
                                            <button class="btn btn-outline-primary" onclick="handleBall(2)">2</button>
                                            <button class="btn btn-outline-primary" onclick="handleBall(3)">3</button>
                                        </div>
                                        <div class="btn-group w-100 mb-2">
                                            <button class="btn btn-outline-primary" onclick="handleBall(4)">4</button>
                                            <button class="btn btn-outline-primary" onclick="handleBall(5)">5</button>
                                            <button class="btn btn-outline-primary" onclick="handleBall(6)">6</button>
                                            <button class="btn btn-outline-primary" onclick="handleBall(7)">7</button>
                                        </div>
                                        <div class="btn-group w-100 mb-2">
                                            <button class="btn btn-outline-danger" onclick="handleWicket('bowled')">Bowled</button>
                                            <button class="btn btn-outline-danger" onclick="handleWicket('caught')">Caught</button>
                                            <button class="btn btn-outline-danger" onclick="handleWicket('runout')">Run Out</button>
                                        </div>
                                        <div class="btn-group w-100 mb-2">
                                            <button class="btn btn-outline-danger" onclick="handleWicket('hitwicket')">Hit Wicket</button>
                                            <button class="btn btn-outline-danger" onclick="handleWicket('lbw')">LBW</button>
                                            <button class="btn btn-outline-danger" onclick="handleWicket('obstructing')">Obstructing</button>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="btn-group w-100 mb-2">
                                            <button class="btn btn-outline-secondary" onclick="handleExtra('wides')">Wide</button>
                                            <button class="btn btn-outline-secondary" onclick="handleExtra('noBalls')">No Ball</button>
                                            <button class="btn btn-outline-secondary" onclick="handleExtra('legsideWides')">Leg Side Wide</button>
                                        </div>
                                        <div class="btn-group w-100 mb-2">
                                            <button class="btn btn-outline-primary" onclick="showCustomRunsInput()">Custom Runs</button>
                                            <button class="btn btn-outline-danger" onclick="undoLastBall()">Undo</button>
                                            <button class="btn btn-outline-success" onclick="saveMatch()">Save</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Custom Runs Modal -->
    <div id="customRunsModal" class="modal">
        <div class="modal-content">
            <h3>Enter Custom Runs</h3>
            <div class="input-group">
                <input type="number" id="customRuns" class="form-control" min="0">
                <button class="btn btn-primary" onclick="handleCustomRuns()">Submit</button>
                <button class="btn btn-secondary" onclick="closeCustomRunsModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Third Ball Warning Modal -->
    <div id="thirdBallWarningModal" class="modal">
        <div class="modal-content">
            <h3>Third Ball Warning!</h3>
            <p>Two dot balls in a row. Score must change on this ball!</p>
            <button class="btn btn-primary" onclick="closeThirdBallWarning()">OK</button>
        </div>
    </div>

    <!-- Add Ball Modal -->
    <div id="addBallModal" class="modal">
        <div class="modal-content">
            <h3>Extra Ball Available</h3>
            <p>Would you like to add an extra ball to this over?</p>
            <div class="btn-group">
                <button class="btn btn-success" onclick="handleAddBall(true)">Yes</button>
                <button class="btn btn-danger" onclick="handleAddBall(false)">No</button>
            </div>
        </div>
    </div>

    <!-- New Partnership Modal -->
    <div id="newPartnershipModal" class="modal">
        <div class="modal-content">
            <h3>New Partnership</h3>
            <p>Select new batsmen for the next partnership:</p>
            <div class="mb-3">
                <label>Striker:</label>
                <select id="newStriker" class="form-select"></select>
            </div>
            <div class="mb-3">
                <label>Non-Striker:</label>
                <select id="newNonStriker" class="form-select"></select>
            </div>
            <div class="mb-3">
                <label>Bowler:</label>
                <select id="newBowler" class="form-select"></select>
            </div>
            <button class="btn btn-primary" onclick="startNewPartnership()">Start Partnership</button>
        </div>
    </div>

    <!-- Player Selection Modal -->
    <div id="playerSelectModal" class="player-select-modal">
        <div class="player-select-content">
            <h4 id="playerSelectTitle">Select Player</h4>
            <div id="playerList" class="player-list"></div>
            <div class="text-end">
                <button class="btn btn-secondary" onclick="closePlayerSelect()">Cancel</button>
                <button class="btn btn-primary" onclick="applyPlayerSelect()">Apply</button>
            </div>
        </div>
    </div>

    <script>
        // Game State
        let gameState = {
            format: '',
            battingTeam: '',
            fieldingTeam: '',
            target: 0,
            matchDuration: 0,
            currentScore: 0,
            wickets: 0,
            currentOver: 0,
            totalOvers: 0,
            partnershipOvers: 0,
            batsmen: [],
            bowlers: [],
            currentBatsmen: {
                striker: null,
                nonStriker: null
            },
            currentBowler: null,
            ballHistory: [],
            extras: {
                wides: 0,
                noBalls: 0,
                legsideWides: 0
            },
            partnership: {
                runs: 0,
                balls: 0,
                overs: 0
            },
            timer: {
                startTime: null,
                elapsed: 0,
                isRunning: false
            },
            consecutiveDotBalls: 0,
            overs: {
                ballsLeft: 6
            }
        };

        // DOM Elements
        const elements = {
            previewBattingTeam: document.getElementById('previewBattingTeam'),
            previewFieldingTeam: document.getElementById('previewFieldingTeam'),
            previewScore: document.getElementById('previewScore'),
            previewOvers: document.getElementById('previewOvers'),
            matchTimer: document.getElementById('matchTimer'),
            strikerName: document.getElementById('strikerName'),
            nonStrikerName: document.getElementById('nonStrikerName'),
            currentBowlerName: document.getElementById('currentBowlerName'),
            customRunsModal: document.getElementById('customRunsModal'),
            extraBallModal: document.getElementById('extraBallModal'),
            newPartnershipModal: document.getElementById('newPartnershipModal'),
            playerSelectModal: document.getElementById('playerSelectModal')
        };

        // Initialize Game
        function initializeGame() {
            const savedState = localStorage.getItem('indoorCricketGame');
            if (savedState) {
                gameState = JSON.parse(savedState);
                updateDisplay();
            } else {
                window.location.href = 'setup.html';
            }
        }

        // Update Display
        function updateDisplay() {
            elements.previewBattingTeam.textContent = gameState.battingTeam;
            elements.previewFieldingTeam.textContent = gameState.fieldingTeam;
            elements.previewScore.textContent = `${gameState.currentScore}/${gameState.wickets}`;
            elements.previewOvers.textContent = `${gameState.currentOver.toFixed(1)}/${gameState.totalOvers}`;
            
            // Update overs display
            const oversDisplay = document.getElementById('oversDisplay');
            if (oversDisplay) {
                oversDisplay.textContent = `Overs: ${gameState.currentOver.toFixed(1)}/${gameState.totalOvers}`;
            }
            
            // Update balls left display
            const ballsLeftDisplay = document.getElementById('ballsLeft');
            if (ballsLeftDisplay) {
                ballsLeftDisplay.textContent = `Balls Left: ${gameState.overs.ballsLeft}`;
            }
            
            updateBatsmenDisplay();
            updateBowlerSelect();
            updateTimer();
        }

        // Update Batsmen Display
        function updateBatsmenDisplay() {
            elements.strikerName.textContent = gameState.currentBatsmen.striker?.name || 'Select Striker';
            elements.nonStrikerName.textContent = gameState.currentBatsmen.nonStriker?.name || 'Select Non-Striker';
        }

        // Update Bowler Select
        function updateBowlerSelect() {
            const bowlerSelect = elements.currentBowlerName;
            bowlerSelect.textContent = gameState.currentBowler?.name || 'Select Bowler';
        }

        // Timer Functions
        function startTimer() {
            if (!gameState.timer.isRunning) {
                gameState.timer.startTime = Date.now() - gameState.timer.elapsed;
                gameState.timer.isRunning = true;
                updateTimer();
            }
        }

        function stopTimer() {
            gameState.timer.isRunning = false;
        }

        function resetTimer() {
            gameState.timer.elapsed = 0;
            gameState.timer.isRunning = false;
            updateTimer();
        }

        function updateTimer() {
            if (gameState.timer.isRunning) {
                gameState.timer.elapsed = Date.now() - gameState.timer.startTime;
            }
            
            // Calculate remaining time
            const totalTime = gameState.matchDuration * 60 * 1000; // Convert minutes to milliseconds
            const remainingTime = Math.max(0, totalTime - gameState.timer.elapsed);
            
            const minutes = Math.floor(remainingTime / 60000);
            const seconds = Math.floor((remainingTime % 60000) / 1000);
            elements.matchTimer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Update timer color based on remaining time
            if (remainingTime <= 0) {
                elements.matchTimer.classList.add('danger');
                playWarningSound();
            } else if (remainingTime <= 300000) { // 5 minutes
                elements.matchTimer.classList.add('warning');
            } else {
                elements.matchTimer.classList.remove('warning', 'danger');
            }
            
            if (gameState.timer.isRunning) {
                requestAnimationFrame(updateTimer);
            }
        }

        // Handle extras (wides, no balls, legside wides)
        function handleExtra(type) {
            if (!gameState.timer.isRunning) return;
            
            // Check if this is the last over of the partnership
            const isLastOver = Math.floor(gameState.currentOver) === gameState.partnership.overs + 3;
            
            // Add the extra
            gameState.extras[type]++;
            gameState.currentScore++;
            gameState.currentBatsmen.striker.score++;
            gameState.partnership.runs++;
            
            // If it's the last over of the partnership, show the add ball prompt
            if (isLastOver) {
                showAddBallPrompt();
            }
            
            // Update display
            updateDisplay();
            saveGameState();
            updateScoreboard();
        }

        // Handle regular ball
        function handleBall(runs) {
            if (!gameState.timer.isRunning) return;
            
            // Check if this is the last over of the partnership
            const isLastOver = Math.floor(gameState.currentOver) === gameState.partnership.overs + 3;
            
            // Add runs
            gameState.currentScore += runs;
            gameState.currentBatsmen.striker.score += runs;
            gameState.currentBatsmen.striker.balls++;
            gameState.partnership.runs += runs;
            gameState.partnership.balls++;
            
            // Update overs
            gameState.overs.ballsLeft--;
            if (gameState.overs.ballsLeft <= 0) {
                gameState.overs.ballsLeft = 6;
                gameState.currentOver += 0.1;
                if (gameState.currentBowler) {
                    gameState.currentBowler.overs += 0.1;
                }
            }
            
            // Check for third ball warning
            if (runs === 0) {
                checkThirdBallWarning();
            } else {
                // Reset consecutive dot balls if runs were scored
                gameState.consecutiveDotBalls = 0;
            }
            
            // If it's the last over of the partnership and an extra was bowled, don't count this ball
            if (isLastOver && (gameState.extras.wides > 0 || gameState.extras.noBalls > 0 || gameState.extras.legsideWides > 0)) {
                gameState.partnership.balls--;
                gameState.overs.ballsLeft = 6;
            }
            
            // Update display
            updateDisplay();
            saveGameState();
            updateScoreboard();
        }

        // Handle wicket
        function handleWicket(type) {
            if (!gameState.timer.isRunning) return;
            
            // Apply -5 run penalty
            gameState.currentScore -= 5;
            gameState.currentBatsmen.striker.score -= 5;
            gameState.partnership.runs -= 5;
            
            // Add third ball out with -5 runs
            gameState.currentBatsmen.striker.balls += 3;
            gameState.partnership.balls += 3;
            
            // Update display
            updateDisplay();
            saveGameState();
            updateScoreboard();
        }

        // Check for third ball warning
        function checkThirdBallWarning() {
            gameState.consecutiveDotBalls++;
            if (gameState.consecutiveDotBalls === 2) {
                showThirdBallWarning();
            }
        }

        // Show third ball warning
        function showThirdBallWarning() {
            const warningModal = document.getElementById('thirdBallWarningModal');
            warningModal.style.display = 'block';
        }

        // Close third ball warning
        function closeThirdBallWarning() {
            const warningModal = document.getElementById('thirdBallWarningModal');
            warningModal.style.display = 'none';
        }

        // Show add ball prompt
        function showAddBallPrompt() {
            const addBallModal = document.getElementById('addBallModal');
            addBallModal.style.display = 'block';
        }

        // Handle add ball
        function handleAddBall(addBall) {
            const addBallModal = document.getElementById('addBallModal');
            addBallModal.style.display = 'none';
            
            if (addBall) {
                gameState.currentOver += 0.1;
                if (gameState.currentBowler) {
                    gameState.currentBowler.overs += 0.1;
                }
                gameState.overs.ballsLeft = 6;
            }
            
            // Update display and save state
            updateDisplay();
            saveGameState();
            updateScoreboard();
        }

        // New Partnership
        function showNewPartnershipModal() {
            const modal = document.getElementById('newPartnershipModal');
            const newStrikerSelect = document.getElementById('newStriker');
            const newNonStrikerSelect = document.getElementById('newNonStriker');
            const newBowlerSelect = document.getElementById('newBowler');

            // Get available players for each position
            const availableBatsmen = gameState.batsmen.filter(batsman => 
                !gameState.currentBatsmen.striker || batsman.id !== gameState.currentBatsmen.striker.id
            );
            
            const availableBowlers = gameState.bowlers.filter(bowler => 
                !gameState.currentBowler || bowler.id !== gameState.currentBowler.id
            );
            
            // Update the select elements
            newStrikerSelect.innerHTML = availableBatsmen.map(p => 
                `<option value="${p.id}">${p.name}</option>`
            ).join('');
            
            newNonStrikerSelect.innerHTML = availableBatsmen.map(p => 
                `<option value="${p.id}">${p.name}</option>`
            ).join('');
            
            newBowlerSelect.innerHTML = availableBowlers.map(p => 
                `<option value="${p.id}">${p.name}</option>`
            ).join('');

            modal.style.display = 'block';
        }

        function startNewPartnership() {
            const newStrikerId = parseInt(document.getElementById('newStriker').value);
            const newNonStrikerId = parseInt(document.getElementById('newNonStriker').value);
            const newBowlerId = parseInt(document.getElementById('newBowler').value);

            if (!newStrikerId || !newNonStrikerId || !newBowlerId) {
                alert('Please select all players');
                return;
            }

            // Find the selected players
            const newStriker = gameState.batsmen.find(b => b.id === newStrikerId);
            const newNonStriker = gameState.batsmen.find(b => b.id === newNonStrikerId);
            const newBowler = gameState.bowlers.find(b => b.id === newBowlerId);

            if (!newStriker || !newNonStriker || !newBowler) {
                alert('Error finding selected players');
                return;
            }

            // Update the current players
            gameState.currentBatsmen.striker = newStriker;
            gameState.currentBatsmen.nonStriker = newNonStriker;
            gameState.currentBowler = newBowler;

            // Reset partnership stats
            gameState.partnership = {
                runs: 0,
                balls: 0,
                overs: Math.floor(gameState.currentOver)
            };

            // Close modal and update display
            document.getElementById('newPartnershipModal').style.display = 'none';
            updateDisplay();
            saveGameState();
            updateScoreboard();
        }

        // Custom Runs
        function showCustomRunsInput() {
            elements.customRunsModal.style.display = 'block';
        }

        function closeCustomRunsModal() {
            elements.customRunsModal.style.display = 'none';
        }

        function handleCustomRuns() {
            const runs = parseInt(document.getElementById('customRuns').value);
            if (isNaN(runs) || runs < 0) {
                alert('Please enter a valid number');
                return;
            }
            handleBall(runs);
            document.getElementById('customRuns').value = '';
        }

        // Undo Last Ball
        function undoLastBall() {
            if (gameState.ballHistory.length === 0) return;
            
            const lastBall = gameState.ballHistory.pop();
            
            // Update overs
            if (gameState.overs.ballsLeft >= 6) {
                gameState.currentOver -= 0.1;
                if (gameState.currentBowler) {
                    gameState.currentBowler.overs -= 0.1;
                }
                gameState.overs.ballsLeft = 6;
            } else {
                gameState.overs.ballsLeft++;
            }
            
            if (lastBall.type && lastBall.type.includes('wicket')) {
                gameState.wickets--;
                if (gameState.currentBowler) {
                    gameState.currentBowler.wickets--;
                }
                gameState.currentScore += 5; // Restore penalty runs
                gameState.currentBatsmen.striker.score += 5;
                gameState.partnership.runs += 5;
            } else {
                gameState.currentScore -= lastBall.runs;
                gameState.currentBatsmen.striker.score -= lastBall.runs;
                gameState.currentBatsmen.striker.balls--;
                gameState.partnership.runs -= lastBall.runs;
                gameState.partnership.balls--;
                if (gameState.currentBowler) {
                    gameState.currentBowler.runs -= lastBall.runs;
                }
                
                if (lastBall.type) {
                    gameState.extras[lastBall.type]--;
                }
            }
            
            updateDisplay();
            saveGameState();
            updateScoreboard();
        }

        // Save Game State
        function saveGameState() {
            localStorage.setItem('indoorCricketGame', JSON.stringify(gameState));
        }

        // Save Match
        function saveMatch() {
            const matchData = {
                ...gameState,
                timestamp: new Date(),
                status: 'completed'
            };
            
            const savedMatches = JSON.parse(localStorage.getItem('indoorCricketMatches') || '[]');
            savedMatches.push(matchData);
            localStorage.setItem('indoorCricketMatches', JSON.stringify(savedMatches));
            
            alert('Match saved successfully!');
        }

        // Update Scoreboard
        function updateScoreboard() {
            localStorage.setItem('lastUpdate', Date.now().toString());
        }

        // Player selection system
        let currentSelection = {
            type: null,
            players: []
        };

        // Get available players based on type
        function getAvailablePlayers(type) {
            if (type === 'striker' || type === 'nonStriker') {
                return gameState.batsmen.filter(batsman => 
                    !gameState.currentBatsmen.striker || batsman.id !== gameState.currentBatsmen.striker.id
                );
            } else if (type === 'bowler') {
                return gameState.bowlers.filter(bowler => 
                    !gameState.currentBowler || bowler.id !== gameState.currentBowler.id
                );
            }
            return [];
        }

        function showPlayerSelect(type) {
            currentSelection.type = type;
            const modal = document.getElementById('playerSelectModal');
            const title = document.getElementById('playerSelectTitle');
            const playerList = document.getElementById('playerList');

            title.textContent = `Select ${type.charAt(0).toUpperCase() + type.slice(1)}`;
            
            // Get available players based on type
            const players = getAvailablePlayers(type);
            
            playerList.innerHTML = players.map(player => `
                <div class="player-item" onclick="selectPlayer('${player.id}')">
                    ${player.name}
                </div>
            `).join('');

            modal.style.display = 'block';
        }

        function selectPlayer(playerId) {
            const items = document.querySelectorAll('.player-item');
            items.forEach(item => item.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
            currentSelection.selectedId = playerId;
        }

        function applyPlayerSelect() {
            if (!currentSelection.selectedId) {
                alert('Please select a player');
                return;
            }

            const playerId = parseInt(currentSelection.selectedId);
            let player;

            switch (currentSelection.type) {
                case 'striker':
                    player = gameState.batsmen.find(b => b.id === playerId);
                    gameState.currentBatsmen.striker = player;
                    elements.strikerName.textContent = player.name;
                    break;
                case 'nonStriker':
                    player = gameState.batsmen.find(b => b.id === playerId);
                    gameState.currentBatsmen.nonStriker = player;
                    elements.nonStrikerName.textContent = player.name;
                    break;
                case 'bowler':
                    player = gameState.bowlers.find(b => b.id === playerId);
                    gameState.currentBowler = player;
                    elements.currentBowlerName.textContent = player.name;
                    break;
            }

            closePlayerSelect();
            saveGameState();
        }

        function closePlayerSelect() {
            document.getElementById('playerSelectModal').style.display = 'none';
            currentSelection = { type: null, players: [], selectedId: null };
        }

        // Strike change functionality
        function changeStrike() {
            const temp = gameState.currentBatsmen.striker;
            gameState.currentBatsmen.striker = gameState.currentBatsmen.nonStriker;
            gameState.currentBatsmen.nonStriker = temp;
            updateBatsmenDisplay();
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            initializeGame();
            // Open scoreboard in new window with a slight delay
            setTimeout(() => {
                const scoreboardWindow = window.open('scoreboard-combined.html', 'Scoreboard', 'width=800,height=600');
                if (scoreboardWindow) {
                    console.log('Scoreboard opened successfully');
                } else {
                    console.log('Failed to open scoreboard - popup might be blocked');
                }
            }, 1000);
        });
    </script>
</body>
</html>
