<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indoor Cricket Scorer - Scoreboard</title>
    <style>
        body {
            background-color: #1a1a1a;
            color: #ffffff;
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            background-color: #2d2d2d;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .match-info {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .team-section {
            background-color: #1a1a1a;
            padding: 20px;
            border-radius: 8px;
        }

        .team-name {
            font-size: 2em;
            color: #4CAF50;
            margin-bottom: 10px;
        }

        .main-score {
            font-size: 3em;
            margin: 10px 0;
        }

        .overs {
            font-size: 1.5em;
            color: #888;
        }

        .match-status {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        .timer {
            font-size: 2em;
            color: #ff9800;
        }

        .current-over {
            font-size: 1.2em;
            color: #4CAF50;
        }

        .partnerships {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .partnership-section {
            background-color: #1a1a1a;
            padding: 15px;
            border-radius: 8px;
        }

        .partnership-title {
            color: #4CAF50;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .partnership-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .partnership-item {
            margin-bottom: 5px;
            font-size: 1.1em;
        }

        .current-players {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .player-section {
            background-color: #1a1a1a;
            padding: 15px;
            border-radius: 8px;
        }

        .player-title {
            color: #4CAF50;
            margin-bottom: 10px;
        }

        .error {
            color: #ff4444;
            text-align: center;
            margin: 20px 0;
            padding: 10px;
            background-color: #1a1a1a;
            border-radius: 4px;
            display: none;
        }

        @media (max-width: 768px) {
            .match-info {
                grid-template-columns: 1fr;
            }
            .partnerships, .current-players {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Indoor Cricket Scoreboard</h1>
        </div>

        <div class="match-info">
            <div class="team-section">
                <div id="teamAName" class="team-name">Team A</div>
                <div id="teamAScore" class="main-score">0/0</div>
                <div id="teamAOvers" class="overs">0.0 overs</div>
            </div>

            <div class="match-status">
                <div id="timer" class="timer">20:00</div>
                <div id="currentOver" class="current-over">Current Over: 0.0</div>
                <div id="requiredRate" class="required-rate"></div>
            </div>

            <div class="team-section">
                <div id="teamBName" class="team-name">Team B</div>
                <div id="teamBScore" class="main-score">0/0</div>
                <div id="teamBOvers" class="overs">0.0 overs</div>
            </div>
        </div>

        <div class="current-players">
            <div class="player-section">
                <div class="player-title">Current Batsmen</div>
                <div id="striker" class="player-info">Striker: -</div>
                <div id="nonStriker" class="player-info">Non-striker: -</div>
            </div>
            <div class="player-section">
                <div class="player-title">Current Bowler</div>
                <div id="currentBowler" class="player-info">Bowler: -</div>
                <div id="bowlerFigures" class="player-info">Figures: 0/0</div>
            </div>
        </div>

        <div class="partnerships">
            <div class="partnership-section">
                <div class="partnership-title">Team A Partnerships</div>
                <ul id="teamAPartnerships" class="partnership-list">
                    <li class="partnership-item">No partnerships yet</li>
                </ul>
            </div>
            <div class="partnership-section">
                <div class="partnership-title">Team B Partnerships</div>
                <ul id="teamBPartnerships" class="partnership-list">
                    <li class="partnership-item">No partnerships yet</li>
                </ul>
            </div>
        </div>

        <div id="errorContainer" class="error"></div>
    </div>

    <script>
        let matchData = null;
        let updateInterval = null;

        function debugLog(message) {
            console.log(`${new Date().toISOString()}: ${message}`);
        }

        function showError(message) {
            const errorContainer = document.getElementById('errorContainer');
            if (errorContainer) {
                errorContainer.textContent = message;
                errorContainer.style.display = 'block';
            }
            debugLog(`Error: ${message}`);
        }

        function updatePartnerships(team, partnerships) {
            const list = document.getElementById(`team${team}Partnerships`);
            if (!list || !partnerships || partnerships.length === 0) {
                return;
            }

            list.innerHTML = partnerships.map(p => 
                `<li class="partnership-item">${p.batsman1} & ${p.batsman2}: ${p.runs} runs</li>`
            ).join('');
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function updateDisplay() {
            if (!matchData) return;

            // Update team names and scores
            document.getElementById('teamAName').textContent = matchData.teamA;
            document.getElementById('teamBName').textContent = matchData.teamB;
            
            document.getElementById('teamAScore').textContent = 
                `${matchData.scores.A.runs}/${matchData.scores.A.wickets}`;
            document.getElementById('teamBScore').textContent = 
                `${matchData.scores.B.runs}/${matchData.scores.B.wickets}`;

            // Update overs
            document.getElementById('teamAOvers').textContent = 
                `${matchData.scores.A.overs}.${matchData.scores.A.balls} overs`;
            document.getElementById('teamBOvers').textContent = 
                `${matchData.scores.B.overs}.${matchData.scores.B.balls} overs`;

            // Update current innings info
            const inningsSide = matchData.currentInnings === 1 ? matchData.battingFirst : 
                (matchData.battingFirst === 'A' ? 'B' : 'A');
            
            // Update batsmen
            const currentBatsmen = matchData.currentBatsmen[inningsSide];
            if (currentBatsmen && currentBatsmen.length >= 2) {
                document.getElementById('striker').textContent = `Striker: ${currentBatsmen[0]}`;
                document.getElementById('nonStriker').textContent = `Non-striker: ${currentBatsmen[1]}`;
            }

            // Update bowler
            document.getElementById('currentBowler').textContent = 
                `Bowler: ${matchData.currentBowler}`;

            // Update current over
            const currentScore = matchData.scores[inningsSide];
            document.getElementById('currentOver').textContent = 
                `Current Over: ${currentScore.overs}.${currentScore.balls}`;

            // Update partnerships if available
            if (matchData.partnerships) {
                updatePartnerships('A', matchData.partnerships.A);
                updatePartnerships('B', matchData.partnerships.B);
            }

            // Update required rate in second innings
            if (matchData.currentInnings === 2) {
                const battingTeam = matchData.battingFirst === 'A' ? 'B' : 'A';
                const targetScore = matchData.scores[matchData.battingFirst].runs + 1;
                const currentScore = matchData.scores[battingTeam].runs;
                const remainingRuns = targetScore - currentScore;
                const maxOvers = parseInt(matchData.matchFormat);
                const currentOvers = matchData.scores[battingTeam].overs + 
                    (matchData.scores[battingTeam].balls / 6);
                const remainingOvers = maxOvers - currentOvers;
                
                if (remainingOvers > 0) {
                    const requiredRate = (remainingRuns / remainingOvers).toFixed(2);
                    document.getElementById('requiredRate').textContent = 
                        `Required Rate: ${requiredRate}`;
                }
            }
        }

        // Initialize page and start auto-updates
        document.addEventListener('DOMContentLoaded', () => {
            try {
                // Initial load
                const data = localStorage.getItem('matchData');
                if (!data) {
                    throw new Error('No match data found');
                }
                matchData = JSON.parse(data);
                updateDisplay();

                // Update every second
                updateInterval = setInterval(() => {
                    const newData = localStorage.getItem('matchData');
                    if (newData) {
                        matchData = JSON.parse(newData);
                        updateDisplay();
                    }
                }, 1000);

                debugLog('Scoreboard initialized successfully');
            } catch (error) {
                showError(`Failed to initialize scoreboard: ${error.message}`);
            }
        });

        // Clean up interval when page is closed
        window.addEventListener('beforeunload', () => {
            if (updateInterval) {
                clearInterval(updateInterval);
            }
        });
    </script>
</body>
</html>
