<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Scoreboard</title>
    <audio id="buzzerSound" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"></audio>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1a1a2e;
            color: #fff;
            margin: 0;
            padding: 10px;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .scoreboard {
            width: 100%;
            max-width: 1920px;
            margin: auto;
            background: #16213e;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.2);
        }
        .header {
            text-align: center;
            margin-bottom: 15px;
            padding: 10px;
            background: #0f3460;
            border-radius: 8px;
            border-bottom: 2px solid #e94560;
        }
        .header h1 {
            margin: 0;
            font-size: clamp(24px, 4vw, 36px);
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }
        .timer-section {
            text-align: center;
            margin: 10px 0;
            padding: 10px;
            background: #0f3460;
            border-radius: 8px;
            border: 1px solid #e94560;
        }
        .timer-display {
            font-size: clamp(32px, 5vw, 48px);
            color: #ffd700;
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
            font-weight: bold;
            font-family: 'Digital', monospace;
        }
        .timer-warning {
            color: #e94560;
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        .team-section {
            margin: 10px 0;
            padding: 15px;
            background: #1f2937;
            border-radius: 8px;
            border: 1px solid #e94560;
        }
        .team-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-size: clamp(20px, 3vw, 28px);
            color: #e94560;
        }
        .team-total {
            font-size: clamp(28px, 4vw, 40px);
            color: #00ff9d;
            text-shadow: 0 0 10px rgba(0, 255, 157, 0.3);
        }
        .batting-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 10px 0;
        }
        .batsman {
            background: #2a3b4c;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #e94560;
        }
        .batsman.on-strike {
            border-color: #00ff9d;
            box-shadow: 0 0 15px rgba(0, 255, 157, 0.2);
        }
        .batsman-name {
            font-size: clamp(16px, 2.5vw, 22px);
            color: #e94560;
            margin-bottom: 5px;
        }
        .batsman-stats {
            font-size: clamp(14px, 2vw, 18px);
            color: #fff;
        }
        .partnerships {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin: 10px 0;
        }
        .partnership {
            background: #2a3b4c;
            padding: 8px;
            border-radius: 5px;
            text-align: center;
            font-size: clamp(14px, 1.8vw, 16px);
            border: 1px solid #e94560;
        }
        .partnership.active {
            background: #0f3460;
            border: 1px solid #00ff9d;
        }
        .current-bowler {
            text-align: center;
            font-size: clamp(18px, 2.5vw, 24px);
            color: #ffd700;
            margin: 10px 0;
            padding: 8px;
            background: #1f2937;
            border-radius: 8px;
            border: 1px solid #e94560;
        }
        .bowler-stats {
            font-size: clamp(14px, 2vw, 18px);
            color: #00ff9d;
        }
        .target {
            text-align: center;
            font-size: clamp(18px, 2.5vw, 24px);
            color: #e94560;
            margin: 10px 0;
            padding: 8px;
            background: #0f3460;
            border-radius: 8px;
            border: 1px solid #00ff9d;
        }
        @media (max-width: 768px) {
            .scoreboard {
                padding: 10px;
            }
            
            .team-section {
                padding: 10px;
            }
            
            .partnerships {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .batting-details {
                gap: 10px;
            }
        }
        @media (max-width: 480px) {
            .partnerships {
                grid-template-columns: 1fr;
            }
            
            .team-header {
                flex-direction: column;
                text-align: center;
                gap: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="scoreboard">
        <div class="header">
            <h1>Indoor Cricket Scoreboard</h1>
        </div>

        <div class="timer-section">
            <div class="timer-display" id="inningsTimer">00:00</div>
        </div>

        <!-- Team A Section -->
        <div class="team-section" id="teamASection">
            <div class="team-header">
                <div id="teamA">Team A</div>
                <div class="team-total" id="teamATotal">0</div>
            </div>
            <div class="batting-details">
                <div class="batsman" id="teamABatsman1">
                    <div class="batsman-name" id="teamABatsman1Name">Batsman 1</div>
                    <div class="batsman-stats" id="teamABatsman1Stats">0 (0)</div>
                </div>
                <div class="batsman" id="teamABatsman2">
                    <div class="batsman-name" id="teamABatsman2Name">Batsman 2</div>
                    <div class="batsman-stats" id="teamABatsman2Stats">0 (0)</div>
                </div>
            </div>
            <div class="partnerships" id="teamAPartnerships">
                <!-- Partnerships will be dynamically added here -->
            </div>
        </div>

        <!-- Team B Section -->
        <div class="team-section" id="teamBSection">
            <div class="team-header">
                <div id="teamB">Team B</div>
                <div class="team-total" id="teamBTotal">0</div>
            </div>
            <div class="batting-details">
                <div class="batsman" id="teamBBatsman1">
                    <div class="batsman-name" id="teamBBatsman1Name">Batsman 1</div>
                    <div class="batsman-stats" id="teamBBatsman1Stats">0 (0)</div>
                </div>
                <div class="batsman" id="teamBBatsman2">
                    <div class="batsman-name" id="teamBBatsman2Name">Batsman 2</div>
                    <div class="batsman-stats" id="teamBBatsman2Stats">0 (0)</div>
                </div>
            </div>
            <div class="partnerships" id="teamBPartnerships">
                <!-- Partnerships will be dynamically added here -->
            </div>
        </div>

        <!-- Bottom Info Bar -->
        <div class="current-bowler">
            <div id="currentBowler">Current Bowler: </div>
            <div class="bowler-stats" id="bowlerStats">Overs: 0.0 | Wickets: 0</div>
        </div>

        <!-- Target Display (for second innings) -->
        <div class="target" id="target" style="display: none;">
            Target: 0 runs from 12 overs
        </div>
    </div>
        <script>
        let matchData = {
            teamA: {
                totalScore: 0,
                wickets: 0,
                partnerships: [],
                currentBatsmen: {
                    batsman1: { name: '', score: 0, balls: 0 },
                    batsman2: { name: '', score: 0, balls: 0 }
                }
            },
            teamB: {
                totalScore: 0,
                wickets: 0,
                partnerships: [],
                currentBatsmen: {
                    batsman1: { name: '', score: 0, balls: 0 },
                    batsman2: { name: '', score: 0, balls: 0 }
                }
            },
            currentInnings: 'A',
            overs: 0,
            balls: 0,
            currentBowler: { name: '', overs: 0, wickets: 0 },
            partnershipNumber: 1,
            onStrike: 'batsman1',
            matchFormat: 12,
            totalPartnerships: 3
        };

        let timerInterval;
        let remainingTime;
        let isTimerRunning = false;
        let timerStartTime;
        let totalTime;
        const buzzerSound = document.getElementById('buzzerSound');

        function startTimer(minutes) {
            if (isTimerRunning) return;
            
            totalTime = minutes * 60;
            timerStartTime = Date.now();
            isTimerRunning = true;
            
            timerInterval = setInterval(() => {
                if (!isTimerRunning) return;

                const elapsedSeconds = Math.floor((Date.now() - timerStartTime) / 1000);
                remainingTime = Math.max(0, totalTime - elapsedSeconds);

                if (remainingTime <= 0) {
                    clearInterval(timerInterval);
                    isTimerRunning = false;
                    document.getElementById('inningsTimer').textContent = '00:00';
                    buzzerSound.play().catch(error => console.log('Error playing sound:', error));
                    return;
                }

                const minutes = Math.floor(remainingTime / 60);
                const seconds = remainingTime % 60;
                
                const display = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                document.getElementById('inningsTimer').textContent = display;

                if (remainingTime <= 300) {
                    document.getElementById('inningsTimer').classList.add('timer-warning');
                }

                remainingTime--;
            }, 1000);
        }

        function updateDisplay() {
            try {
                if (isLocalStorageAvailable()) {
                    const storedData = JSON.parse(localStorage.getItem("matchData"));
                    if (storedData) {
                        matchData = storedData;
                    }

                    // Get match format and total partnerships
                    const matchFormat = parseInt(localStorage.getItem("matchFormat")) || 12;
                    const totalPartnerships = parseInt(localStorage.getItem("totalPartnerships")) || 3;
                    
                    // Update matchData with these values
                    matchData.matchFormat = matchFormat;
                    matchData.totalPartnerships = totalPartnerships;

                    // Initialize partnerships array if needed
                    if (matchData.teamA.partnerships.length !== totalPartnerships) {
                        matchData.teamA.partnerships = new Array(totalPartnerships).fill(0);
                        matchData.teamB.partnerships = new Array(totalPartnerships).fill(0);
                    }

                    // Check if innings should end
                    if (matchData.overs >= matchFormat) {
                        if (matchData.currentInnings === 'A') {
                            matchData.currentInnings = 'B';
                            // Reset innings-specific data
                            matchData.overs = 0;
                            matchData.balls = 0;
                            matchData.partnershipNumber = 1;
                            matchData.currentBowler = { name: '', overs: 0, wickets: 0 };
                            // Prompt for new batsmen and bowler
                            promptNewBatsmen();
                            promptNewBowler();
                        }
                    }

                    // Handle timer status
                    const timerStatus = localStorage.getItem("timerStatus");
                    const timerStartTime = localStorage.getItem("timerStartTime");
                    const inningsTime = parseInt(localStorage.getItem("inningsTimer")) || 20;

                    if (timerStatus === "running" && !isTimerRunning) {
                        startTimer(inningsTime);
                    } else if (timerStatus === "paused") {
                        isTimerRunning = false;
                    } else if (timerStatus === "stopped") {
                        isTimerRunning = false;
                        clearInterval(timerInterval);
                        document.getElementById('inningsTimer').textContent = 
                            `${inningsTime.toString().padStart(2, '0')}:00`;
                        document.getElementById('inningsTimer').classList.remove('timer-warning');
                    }

                    const teamA = localStorage.getItem("teamA");
                    const teamB = localStorage.getItem("teamB");
                    const batsman1 = localStorage.getItem("batsman1");
                    const batsman2 = localStorage.getItem("batsman2");
                    const bowler = localStorage.getItem("bowler");

                    // Update team names
                    document.getElementById("teamA").textContent = teamA;
                    document.getElementById("teamB").textContent = teamB;

                    // Update team totals (runs only)
                    document.getElementById("teamATotal").textContent = matchData.teamA.totalScore;
                    document.getElementById("teamBTotal").textContent = matchData.teamB.totalScore;

                    // Show/hide team sections based on current innings
                    document.getElementById("teamASection").style.display = 
                        matchData.currentInnings === 'A' ? 'block' : 'none';
                    document.getElementById("teamBSection").style.display = 
                        matchData.currentInnings === 'B' ? 'block' : 'none';

                    // Update partnerships for both teams (always visible)
                    updatePartnerships('A', matchData.teamA.partnerships);
                    updatePartnerships('B', matchData.teamB.partnerships);

                    // Update batsmen details only for batting team
                    if (matchData.currentInnings === 'A') {
                        updateBatsmenDisplay('A', matchData.teamA.currentBatsmen);
                    } else {
                        updateBatsmenDisplay('B', matchData.teamB.currentBatsmen);
                    }

                    // Update current bowler only for bowling team
                    if (matchData.currentInnings === 'A') {
                        document.getElementById("currentBowler").textContent = 
                            `Current Bowler: ${matchData.currentBowler.name}`;
                        document.getElementById("bowlerStats").textContent = 
                            `Overs: ${matchData.currentBowler.overs}.${matchData.balls} | Wickets: ${matchData.currentBowler.wickets}`;
                    } else {
                        document.getElementById("currentBowler").textContent = 
                            `Current Bowler: ${matchData.currentBowler.name}`;
                        document.getElementById("bowlerStats").textContent = 
                            `Overs: ${matchData.currentBowler.overs}.${matchData.balls} | Wickets: ${matchData.currentBowler.wickets}`;
                    }

                    // Show target if in second innings
                    const targetDiv = document.getElementById("target");
                    if (matchData.currentInnings === 'B') {
                        const target = matchData.teamA.totalScore + 1;
                        targetDiv.style.display = "block";
                        targetDiv.textContent = `Target: ${target} runs from ${matchFormat} overs`;
                    } else {
                        targetDiv.style.display = "none";
                    }
                }
            } catch (error) {
                console.error('Error updating display:', error);
            }
        }

        function updateBatsmenDisplay(team, batsmen) {
            document.getElementById(`team${team}Batsman1Name`).textContent = batsmen.batsman1.name;
            document.getElementById(`team${team}Batsman1Stats`).textContent = 
                `${batsmen.batsman1.score} (${batsmen.batsman1.balls})`;
            document.getElementById(`team${team}Batsman2Name`).textContent = batsmen.batsman2.name;
            document.getElementById(`team${team}Batsman2Stats`).textContent = 
                `${batsmen.batsman2.score} (${batsmen.batsman2.balls})`;

            // Update strike indicator
            const onStrike = matchData.currentInnings === team ? 
                (matchData.onStrike === 'batsman1' ? 'Batsman1' : 'Batsman2') : null;
            
            document.getElementById(`team${team}Batsman1`).classList.toggle("on-strike", 
                onStrike === 'Batsman1');
            document.getElementById(`team${team}Batsman2`).classList.toggle("on-strike", 
                onStrike === 'Batsman2');
        }

        function updatePartnerships(team, partnerships) {
            const container = document.getElementById(`team${team}Partnerships`);
            container.innerHTML = ''; // Clear existing partnerships
            
            partnerships.forEach((score, index) => {
                const partnershipDiv = document.createElement('div');
                partnershipDiv.className = 'partnership';
                partnershipDiv.textContent = `Partnership ${index + 1}: ${score}`;
                if (matchData.currentInnings === team && matchData.partnershipNumber === index + 1) {
                    partnershipDiv.classList.add('active');
                }
                container.appendChild(partnershipDiv);
            });
        }

        function isLocalStorageAvailable() {
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                return true;
            } catch(e) {
                return false;
            }
        }

        // Update display when storage changes
        window.addEventListener('storage', updateDisplay);
        
        // Initial update
        updateDisplay();
        
        // Update every second
        setInterval(updateDisplay, 1000);

        // Cleanup when page is closed
        window.addEventListener('beforeunload', () => {
            clearInterval(timerInterval);
        });
    </script>
</body>
</html>
