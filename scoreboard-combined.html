<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indoor Cricket Scoreboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #000;
            color: #fff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
        }
        .scoreboard-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .team-section {
            background: #1a1a1a;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .team-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .team-name {
            font-size: 2.5rem;
            font-weight: bold;
            color: #fff;
        }
        .team-score {
            font-size: 3rem;
            font-weight: bold;
            color: #fff;
        }
        .partnerships {
            display: flex;
            flex-direction: row;
            overflow-x: auto;
            gap: 10px;
            margin-top: 20px;
            padding-bottom: 10px;
        }
        .partnership-box {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            padding: 15px;
            min-width: 200px;
            flex-shrink: 0;
        }
        .partnership-header {
            color: #fff;
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            padding-bottom: 5px;
        }
        .partnership-content {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .partnership-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .partnership-runs {
            color: #fff;
            font-size: 1.2em;
            font-weight: bold;
        }
        .partnership-overs {
            color: #ccc;
            font-size: 0.9em;
        }
        .partnership-batsmen {
            display: flex;
            flex-direction: column;
            gap: 3px;
            font-size: 0.9em;
        }
        .batsman {
            display: flex;
            justify-content: space-between;
            color: #fff;
        }
        .current-players {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
        }
        .current-batsmen {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        .current-bowler {
            text-align: center;
            color: #fff;
            font-size: 1.1em;
        }
        .bowler-name {
            font-weight: bold;
            color: #ff6b6b;
        }
        .bowler-figures {
            margin-left: 10px;
        }
        .bottom-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding: 15px;
            background: #1a1a1a;
            border-radius: 10px;
        }
        .timer {
            font-size: 2rem;
            font-weight: bold;
            color: #fff;
        }
        .timer.warning {
            color: #ffc107;
        }
        .timer.danger {
            color: #dc3545;
        }
        .overs-info {
            display: flex;
            gap: 20px;
            font-size: 1.5rem;
            color: #fff;
        }
        .overs-display, .balls-left {
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 20px;
            border-radius: 5px;
        }
        @media (max-width: 768px) {
            .team-name {
                font-size: 2rem;
            }
            .team-score {
                font-size: 2.5rem;
            }
            .partnership {
                min-width: 80px;
            }
            .partnership-score {
                font-size: 1.2rem;
            }
            .batsman-name {
                font-size: 1rem;
            }
            .batsman-score {
                font-size: 1.2rem;
            }
            .timer {
                font-size: 1.5rem;
            }
            .overs-display, .balls-left {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <div class="scoreboard-container">
        <!-- First Team Section -->
        <div class="team-section">
            <div class="team-header">
                <div class="team-name" id="team1Name">Team A</div>
                <div class="team-score" id="team1Score">0</div>
            </div>
            <div class="partnerships" id="team1Partnerships">
                <!-- Partnerships will be added here dynamically -->
            </div>
            <div class="current-players">
                <div class="current-batsmen">
                    <div class="batsman">
                        <div class="batsman-name" id="team1StrikerName">Striker</div>
                        <div class="batsman-score" id="team1StrikerScore">0</div>
                        <div class="batsman-balls" id="team1StrikerBalls">(0)</div>
                    </div>
                    <div class="batsman">
                        <div class="batsman-name" id="team1NonStrikerName">Non-Striker</div>
                        <div class="batsman-score" id="team1NonStrikerScore">0</div>
                        <div class="batsman-balls" id="team1NonStrikerBalls">(0)</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Second Team Section -->
        <div class="team-section">
            <div class="team-header">
                <div class="team-name" id="team2Name">Team B</div>
                <div class="team-score" id="team2Score">0</div>
            </div>
            <div class="partnerships" id="team2Partnerships">
                <!-- Partnerships will be added here dynamically -->
            </div>
            <div class="current-players">
                <div class="current-batsmen">
                    <div class="batsman">
                        <div class="batsman-name" id="team2StrikerName">Striker</div>
                        <div class="batsman-score" id="team2StrikerScore">0</div>
                        <div class="batsman-balls" id="team2StrikerBalls">(0)</div>
                    </div>
                    <div class="batsman">
                        <div class="batsman-name" id="team2NonStrikerName">Non-Striker</div>
                        <div class="batsman-score" id="team2NonStrikerScore">0</div>
                        <div class="batsman-balls" id="team2NonStrikerBalls">(0)</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Info Section -->
        <div class="bottom-info">
            <div class="timer" id="matchTimer">00:00</div>
            <div class="overs-info">
                <div class="overs-display" id="oversDisplay">Overs: 0.0/16.0</div>
                <div class="balls-left" id="ballsLeft">Balls Left: 6</div>
            </div>
        </div>
    </div>

    <script>
        // Audio for timer warning
        const warningSound = new Audio('warning.mp3');

        let gameState = {
            team1: {
                name: '',
                score: 0,
                partnerships: [],
                currentBatsmen: {
                    striker: { name: '', score: 0, balls: 0 },
                    nonStriker: { name: '', score: 0, balls: 0 }
                }
            },
            team2: {
                name: '',
                score: 0,
                partnerships: [],
                currentBatsmen: {
                    striker: { name: '', score: 0, balls: 0 },
                    nonStriker: { name: '', score: 0, balls: 0 }
                }
            },
            timer: {
                minutes: 0,
                seconds: 0,
                isRunning: false
            },
            overs: {
                current: 0,
                total: 16,
                ballsLeft: 6
            },
            format: '' // Add format to track 6 or 8 aside
        };

        // Update display with new game state
        function updateDisplay() {
            // Update team names and scores
            document.getElementById('team1Name').textContent = gameState.team1.name;
            document.getElementById('team2Name').textContent = gameState.team2.name;
            document.getElementById('team1Score').textContent = gameState.team1.score;
            document.getElementById('team2Score').textContent = gameState.team2.score;

            // Update partnerships
            updatePartnerships('team1Partnerships', gameState.team1.partnerships);
            updatePartnerships('team2Partnerships', gameState.team2.partnerships);

            // Update current batsmen
            updateBatsmen('team1', gameState.team1.currentBatsmen);
            updateBatsmen('team2', gameState.team2.currentBatsmen);

            // Update timer
            updateTimer();

            // Update overs and balls left
            document.getElementById('oversDisplay').textContent = `Overs: ${gameState.overs.current.toFixed(1)}/${gameState.overs.total}`;
            document.getElementById('ballsLeft').textContent = `Balls Left: ${gameState.overs.ballsLeft}`;
        }

        // Update partnerships display
        function updatePartnerships(containerId, partnerships) {
            const container = document.getElementById(containerId);
            container.innerHTML = ''; // Clear existing partnerships
            
            // Get the format from localStorage
            const setupData = JSON.parse(localStorage.getItem('indoorCricketSetup') || '{}');
            const format = setupData.format || '8aside'; // Default to 8aside if not set
            const maxPartnerships = format === '8aside' ? 4 : 3;
            
            // Create empty partnerships if needed
            while (partnerships.length < maxPartnerships) {
                partnerships.push({
                    runs: 0,
                    overs: 0,
                    batsmen: []
                });
            }
            
            partnerships.forEach((partnership, index) => {
                const partnershipElement = document.createElement('div');
                partnershipElement.className = 'partnership-box';
                partnershipElement.innerHTML = `
                    <div class="partnership-header">Partnership ${index + 1}</div>
                    <div class="partnership-content">
                        <div class="partnership-item">
                            <div class="partnership-runs">${partnership.runs} runs</div>
                            <div class="partnership-overs">${partnership.overs.toFixed(1)} ov</div>
                            <div class="partnership-batsmen">
                                ${partnership.batsmen ? partnership.batsmen.map(b => `
                                    <div class="batsman">
                                        <span class="batsman-name">${b.name}</span>
                                        <span class="batsman-score">${b.score} (${b.balls})</span>
                                    </div>
                                `).join('') : ''}
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(partnershipElement);
            });
        }

        // Update batsmen display
        function updateBatsmen(teamPrefix, batsmen) {
            document.getElementById(`${teamPrefix}StrikerName`).textContent = batsmen.striker.name;
            document.getElementById(`${teamPrefix}StrikerScore`).textContent = batsmen.striker.score;
            document.getElementById(`${teamPrefix}StrikerBalls`).textContent = `(${batsmen.striker.balls})`;
            
            document.getElementById(`${teamPrefix}NonStrikerName`).textContent = batsmen.nonStriker.name;
            document.getElementById(`${teamPrefix}NonStrikerScore`).textContent = batsmen.nonStriker.score;
            document.getElementById(`${teamPrefix}NonStrikerBalls`).textContent = `(${batsmen.nonStriker.balls})`;
        }

        // Update timer display
        function updateTimer() {
            const gameState = JSON.parse(localStorage.getItem('indoorCricketGame') || '{}');
            if (!gameState.timer) return;

            const totalTime = gameState.matchDuration * 60 * 1000; // Convert minutes to milliseconds
            const remainingTime = Math.max(0, totalTime - gameState.timer.elapsed);
            
            const minutes = Math.floor(remainingTime / 60000);
            const seconds = Math.floor((remainingTime % 60000) / 1000);
            document.getElementById('matchTimer').textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Update timer color based on remaining time
            const timerElement = document.getElementById('matchTimer');
            if (remainingTime <= 0) {
                timerElement.classList.add('danger');
                playWarningSound();
            } else if (remainingTime <= 300000) { // 5 minutes
                timerElement.classList.add('warning');
            } else {
                timerElement.classList.remove('warning', 'danger');
            }
        }

        // Play warning sound
        function playWarningSound() {
            const audio = new Audio('warning.mp3');
            audio.play().catch(error => console.log('Error playing warning sound:', error));
        }

        // Listen for updates from the umpire's interface
        function listenForUpdates() {
            setInterval(() => {
                const lastUpdate = localStorage.getItem('lastUpdate');
                if (lastUpdate) {
                    const gameStateStr = localStorage.getItem('indoorCricketGame');
                    if (gameStateStr) {
                        const umpireState = JSON.parse(gameStateStr);
                        const setupData = JSON.parse(localStorage.getItem('indoorCricketSetup') || '{}');
                        const format = setupData.format || '8aside';
                        
                        // Convert umpire state to scoreboard state
                        gameState = {
                            team1: {
                                name: umpireState.battingTeam,
                                score: umpireState.currentScore,
                                partnerships: umpireState.partnerships || [],
                                currentBatsmen: {
                                    striker: umpireState.currentBatsmen.striker || { name: '', score: 0, balls: 0 },
                                    nonStriker: umpireState.currentBatsmen.nonStriker || { name: '', score: 0, balls: 0 }
                                }
                            },
                            team2: {
                                name: umpireState.fieldingTeam,
                                score: umpireState.target || 0,
                                partnerships: [],
                                currentBatsmen: {
                                    striker: umpireState.currentBowler || { name: '', score: 0, balls: 0 },
                                    nonStriker: { name: '', score: 0, balls: 0 }
                                }
                            },
                            timer: {
                                minutes: Math.floor((umpireState.matchDuration * 60 - umpireState.timer.elapsed) / 60000),
                                seconds: Math.floor(((umpireState.matchDuration * 60 - umpireState.timer.elapsed) % 60000) / 1000),
                                isRunning: umpireState.timer.isRunning
                            },
                            overs: {
                                current: umpireState.currentOver,
                                total: umpireState.totalOvers,
                                ballsLeft: umpireState.overs?.ballsLeft || 6
                            },
                            format: format
                        };

                        // Update display
                        updateDisplay();
                    }
                }
            }, 100); // Check more frequently for smoother updates
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            // Get setup data
            const setupData = JSON.parse(localStorage.getItem('indoorCricketSetup') || '{}');
            const format = setupData.format || '8aside';
            const maxPartnerships = format === '8aside' ? 4 : 3;
            
            // Test game state with correct number of partnerships
            const testGameState = {
                team1: {
                    name: 'Team A',
                    score: 90,
                    partnerships: Array(maxPartnerships).fill(null).map((_, index) => ({
                        score: 25,
                        runs: 25,
                        overs: 4.0,
                        batsmen: []
                    })),
                    currentBatsmen: {
                        striker: { name: 'Smith', score: 45, balls: 25 },
                        nonStriker: { name: 'Jones', score: 30, balls: 20 }
                    }
                },
                team2: {
                    name: 'Team B',
                    score: 50,
                    partnerships: Array(maxPartnerships).fill(null).map((_, index) => ({
                        score: 35,
                        runs: 35,
                        overs: 5.0,
                        batsmen: []
                    })),
                    currentBatsmen: {
                        striker: { name: 'Wilson', score: 25, balls: 15 },
                        nonStriker: { name: 'Taylor', score: 20, balls: 12 }
                    }
                },
                timer: {
                    minutes: 15,
                    seconds: 30,
                    isRunning: true
                },
                overs: {
                    current: 7.0,
                    total: 16.0,
                    ballsLeft: 6
                },
                format: format
            };

            // Apply test state
            gameState = testGameState;
            updateDisplay();

            // Start listening for updates
            listenForUpdates();
        });
    </script>
</body>
</html>
